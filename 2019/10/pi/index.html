<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>How to Set Up A Photo Library with Raspberry Pi · Rongjia Liu</title><meta name="description" content="How to Set Up A Photo Library with Raspberry Pi - Rongjia Liu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/arctic.css"><link rel="search" type="application/opensearchdescription+xml" href="http://rliu6.com/atom.xml" title="Rongjia Liu"><script src="//code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/search/" target="_self" class="nav-list-link">SEARCH</a></li><!-- li.nav-list-item--><!--    a.nav-list-link(class="search" href=url_for("search") target="_self") <i class="fa fa-search" aria-hidden="true"></i>--></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">How to Set Up A Photo Library with Raspberry Pi</h1><div class="post-info"><!-- if is_post()--><!--     span &#128197; &nbsp;--><!-- uncomment this to show date--><!-- != full_date(item.date, 'll')--><!-- if is_post()--><!--    span#busuanzi_container_page_pv | &#128065;--><!--    span#busuanzi_value_page_pv--><!--    if item.tags--><!--        span | &nbsp;--><!--        for tag in item.tags.toArray()--><!--            a(href=url_for(tag.path))=  '#' + tag.name--><!-- if item.from && (is_home() || is_post())--><!--    a.post-from(href=item.from target="_blank" title=item.from)!= __('translated')-->
</div><div class="post-content"><p><img src="pi-fullsizeoutput_3973.jpeg" alt="fullsizeoutput_3973.jpeg"></p>
<p>Recent I brought a <a href="https://www.raspberrypi.org/products/raspberry-pi-4-model-b/" target="_blank" rel="noopener">Raspberry Pi 4</a> and started playing with it. I first moved my <a href="https://rliu234.com/2019/07/algo-1/" target="_blank" rel="noopener">Bitcoin algorithmic trading strategy</a> from a VPS to the Pi, which dropped the monthly VPS fee from my credit card bill.</p>
<p>My second project is to create a photo library hosted through HTTP, where I can share pictures with my family on the other side of the Pacific ocean. Comparing to other personal cloud storages, this project come with several great advantages:</p>
<ul>
<li>easy to use (only requires a link and a browser)</li>
<li>cheap (can use an idle hard drive as storage)</li>
<li>customizable (easy to change the ascetics and layout)</li>
</ul>
<p>It is also a great project for one learn about the inner working of computer networking as well as front-end developing. So let’s get started.</p>
<p>First we will need a <a href="https://www.amazon.com/gp/product/B07VFCB192/ref=ppx_yo_dt_b_asin_title_o07_s00?ie=UTF8&amp;psc=1" target="_blank" rel="noopener">Raspberry Pi 4</a>. I installed the Raspbian GUI operating system on it which is a pretty neat Linux environment to work on. Next you will have to set up <a href="https://www.raspberrypi.org/documentation/remote-access/web-server/nginx.md" target="_blank" rel="noopener">NGINX and PHP</a>. NGINX will allow us to host web server on Pi and PHP is a back-end programming language that is useful in interacting with the operating system. For this project we will need to write a PHP script which will go through all designated folders to grab all images automatically.</p>
<p>Next up we want to <a href="https://www.raspberrypi.org/documentation/remote-access/ssh/" target="_blank" rel="noopener">set up SSH</a> so that we can access the Pi terminal through local networks. Then we will use the <a href="https://www.raspberrypi.org/documentation/remote-access/ssh/rsync.md" target="_blank" rel="noopener">rsync</a> tool to synchronize the pictures from my laptop to the Pi folder.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -avz -e ssh desktop/image pi@xx.xx.xx.xx:server</span><br></pre></td></tr></table></figure></p>
<p>Here I have a <code>/image</code> folder set up on my Mac desktop, and I want to sync with the <code>/home/pi/server/image</code> folder on my Pi. Use <a href="https://www.linode.com/docs/tools-reference/tools/schedule-tasks-with-cron/" target="_blank" rel="noopener">cron</a> to schedule this command if needed.</p>
<p>Now that we have all the images sync-ed over to your Pi, we can start NGINX and host a static website. Here is my setup. We run our web service on standard port 80 for HTTP and 443 for HTTPS (HTTPS is HTTP with SSL encryption, which is far more secure)<br><code>/etc/nginx/sites-enable/server</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  _;</span><br><span class="line">    return 301 https://$host$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       443;</span><br><span class="line">    server_name  _;</span><br><span class="line">    root         /home/pi/server;</span><br><span class="line">    index        index.php;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =404;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">    	include snippets/fastcgi-php.conf;</span><br><span class="line">    	fastcgi_pass unix:/var/run/php/php7.3-fpm.sock;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ /.well-known &#123;</span><br><span class="line">    	allow all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>/home/pi/server/index.php</code><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome to My Photo Library!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        body &#123;</span></span><br><span class="line"><span class="undefined">            width: auto;</span></span><br><span class="line"><span class="undefined">            margin-left: 2em;</span></span><br><span class="line"><span class="undefined">            margin-right: 2em;</span></span><br><span class="line"><span class="undefined">            font-family: Garamond, serif;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        * &#123;</span></span><br><span class="line"><span class="undefined">            margin: 0;</span></span><br><span class="line"><span class="undefined">            padding: 0;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        img &#123;</span></span><br><span class="line"><span class="undefined">            image-orientation: from-image;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        .imgbox &#123;</span></span><br><span class="line"><span class="undefined">            display: grid;</span></span><br><span class="line"><span class="undefined">            height: 100%;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        .center-fit &#123;</span></span><br><span class="line"><span class="undefined">            max-width: 100%;</span></span><br><span class="line"><span class="undefined">            max-height: 100vh;</span></span><br><span class="line"><span class="undefined">            margin: auto;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        li &#123;</span></span><br><span class="line"><span class="undefined">            list-style-type:none;</span></span><br><span class="line"><span class="undefined">            margin-right:10px;</span></span><br><span class="line"><span class="undefined">            margin-bottom:10px;</span></span><br><span class="line"><span class="undefined">            float:left;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to My Photo Library!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"imgbox"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            &lt;?php</span><br><span class="line">                $handle = opendir(dirname(realpath(__FILE__)).'/image/');       </span><br><span class="line">                while($file = readdir($handle))&#123;</span><br><span class="line">                  if($file !== '.' &amp;&amp; $file !== '..' &amp;&amp; $file !== '.DS_Store')&#123;</span><br><span class="line">                    echo '&lt;img class="center-fit" src="image/'.$file.'"&gt;';</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;     </span><br><span class="line">            ?&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Now open up <code>&lt;local ip address of my pi&gt;:443</code> on my Macbook connected to the same WLAN as my Pi, I will be able to see the webpage I host.</p>
<p><img src="ddns-Screen Shot 2019-10-08 at 6.55.09 AM.png" alt="Screen Shot 2019-10-08 at 6.55.09 AM.png"></p>
<p>Next we need to configure our router for <a href="https://en.wikipedia.org/wiki/Port_forwarding" target="_blank" rel="noopener">Port Forwarding</a> and then set up a <a href="https://en.wikipedia.org/wiki/Dynamic_DNS" target="_blank" rel="noopener">Dynamic DNS</a> service. The <a href="https://www.noip.com" target="_blank" rel="noopener">No-IP</a> website currently provides free DDNS service. After setting up DDNS, we can then use the hostname from your DDNS provider to access the dynamic IP<sup>[1]</sup> address of our router, which will be forwarded to the static IP of our raspberry pi with the port that NGINX used to host the website. For example, we just need to type <code>https://&lt;my hostname from ddns provider&gt;:&lt;my router port designated to forward&gt;</code> in the browser to view the photo library anywhere in the world:)</p>
<p><br></p>
<blockquote>
<p><em>[1] In my case my ISP uses <a href="https://en.wikipedia.org/wiki/Carrier-grade_NAT" target="_blank" rel="noopener">Carrier-Grade NAT</a>, which means my public IP is different than my WAN IP. I will need to configure the DDNS provider to access my WAN IP, in order for this to work.</em></p>
</blockquote>
</div></article></div></main><footer><!-- uncomment this to show paginator--><!-- .paginator--><!--    if prev--><!--        a.prev(href=url_for(prev))!= __('prev_post')--><!--      if next--><!--        a.next(href=url_for(next))!= __('next_post')--><div id="container"></div><!-- link(rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css")--><link rel="stylesheet" href="/css/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
    clientID: '4ec287ddd4ac34ff5087',
    clientSecret: 'ae45426765f12ac3e2f903662b8938dc4881f703',
    repo: 'jackliu234.github.io',
    owner: 'jackliu234',
    admin: ['jackliu234'],
    perPage: 100,
    id: 'Sun Oct 06 2019 00:00:00 GMT-0500 GMT'.split('GMT')[0].replace(/\s/g, '-'),
    distractionFreeMode: false,
    pagerDirection: 'first'
})

gitalk.render('container')</script><!-- block copyright--></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-133275176-1",'auto');ga('send','pageview');</script><link rel="stylesheet" href="//cdn.datatables.net/1.10.7/css/jquery.dataTables.min.css" media="screen" type="text/css"><script src="//cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script><script>$(function(){$('.datatable').dataTable( {"order": [[ 0, "desc" ]],"iDisplayLength": -1,"lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]} );});</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>